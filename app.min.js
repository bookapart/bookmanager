let currentPage=1,itemsPerPage=3,filteredBooks=[...books].reverse(),isSearching=!1,bookMark=(window.alert=function(e){var o=document.createElement("iframe");o.style.display="none",o.src="data:text/plain,",document.body.appendChild(o),o.contentWindow.alert(e),o.remove()},{a:"A 马克思主义、列宁主义、毛泽东思想、邓小平理论",b:"B 哲学、宗教，含美学、心理学",c:"C 社会科学总论，含统计学、管理学",d:"D 政治、法律，含社会运动、外交关系",e:"E 军事",f:"F 经济，含财政、金融",g:"G 文化、科学、教育、体育，含科研、传播",h:"H 语言、文字",i:"I 文学",j:"J 艺术",k:"K 历史、地理，含人物传记、考古风俗",n:"N 自然科学总论，含情报学",o:"O 数理科学和化学",p:"P 天文学、地球科学",q:"Q 生物科学，含人类学",r:"R 医药、卫生",s:"S 农业科学，含农林牧副渔",t:"T 工业技术，含信息产业",u:"U 交通运输",v:"V 航空、航天",x:"X 环境科学、安全科学",z:"Z 综合性图书，含丛书百科、年鉴期刊"});function showSkeleton(){var e=document.getElementById("skeleton");e&&(e.style.display="grid")}function hideSkeleton(){var e=document.getElementById("skeleton");e&&(e.style.display="none")}function book_clc(e,o,t,i){var e=e[0].toLowerCase(),s=document.createElement("div"),o=(s.className="bookmarkdialog",s.innerHTML=`
    <div id="dialogs">
      <div class="js_dialog" role="dialog" aria-hidden="true" aria-modal="true" aria-labelledby="js_title1" id="dialogMark">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
          <div class="weui-dialog__hd">
            <strong class="weui-dialog__title" id="js_title1">${o}</strong>
          </div>
          <div class="weui-dialog__bd">
            ${bookMark[e]??"未知分类"}<br /><br />
            中图分类号：${t}<br />
            美国国会图书馆分类号：${i}
          </div>
          <div class="weui-dialog__ft">
            <a role="button" href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" data-close>确定</a>
          </div>
        </div>
      </div>
    </div>
  `,document.body.appendChild(s),s.querySelector(".js_dialog"));o.style.display="block",o.setAttribute("aria-hidden","false"),o.focus(),o.querySelector("[data-close]").onclick=dialogClose}function dialogClose(){var e=document.getElementById("dialogs");e&&e.remove()}function showGallery(e){var o=document.getElementById("gallery");let t=document.getElementById("galleryImg");o.style.display="block",o.setAttribute("aria-hidden","false"),setTimeout(()=>{t.style.backgroundImage=`url(${e.src})`,t.focus()},200)}function hideGallery(){var e=document.getElementById("gallery"),o=document.getElementById("galleryImg");e.style.display="none",e.setAttribute("aria-hidden","true"),o.style.backgroundImage=""}function createStars(e=0){return'<svg fill="#f3b04b" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>'.repeat(e)+'<svg fill="#dadada" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>'.repeat(5-e)}function toggleCardDetails(e){document.querySelectorAll(".book-card").forEach(e=>e.classList.remove("expanded")),e.classList.add("expanded")}function displayBooks(e){let i=document.getElementById("book-cards");i.innerHTML="",showSkeleton(),setTimeout(()=>{e.slice((currentPage-1)*itemsPerPage,currentPage*itemsPerPage).forEach(e=>{let o=document.createElement("div");o.className="book-card";var t=e.book_cnClassification.slice(0,3).replace(/\d+/g,"").replace("-","");o.innerHTML=`
          <h2>
            <span class="card_mark" onclick="book_clc('${t}','${e.book_name}','${e.book_cnClassification}','${e.book_usClassification}')">${t}</span>
            ${e.book_name}<label>Id.${e.id}</label>
          </h2>
          <div class="book-details">
            <p><strong>主观评级：</strong><span class="book-star">${createStars(e.book_star)}</span></p>
            <div class="thumbnail"><img onclick="showGallery(this);" onerror="this.src='./img/nocover.jpg';" src="./img/${e.book_isbn}.jpg" /></div>
            ${e.book_summary?`<p><strong>内容简介：</strong> ${e.book_summary}</p>`:""}
            ${e.book_dadsay?`<p><strong>爸爸说：</strong> ${e.book_dadsay}</p>`:""}
            ${e.book_momsay?`<p><strong>妈妈说：</strong> ${e.book_momsay}</p>`:""}
            <p><strong>图书信息：</strong>本书作者为 <big>${e.book_author}</big>，由 <big>${e.book_press}</big> 出版，${e.book_presstime?`在架版次为 <big>${e.book_presstime}</big> 。`:""}${e.book_isbn?`ISBN/书号/OCLC为 <big>${e.book_isbn}</big> 。`:""}</p>
            <p><strong>上架信息：</strong>本书${e.book_gettime?`于 <big>${e.book_gettime}</big> `:""}在 <big>${e.book_getcity}</big> ${e.book_getway?`通过 <big>${e.book_getway}</big> `:""}获得。${e.book_price?`定价为 <big>${e.book_pricecurrent} ${e.book_price} 元</big> ，`:""}${e.book_getprice?`获得价格为 <big>${e.book_getpricecurrent} ${e.book_getprice} 元</big> ，`:""}${e.book_count?`实存 <big>${e.book_count}</big> 册，`:""}${e.book_keepcity&&0!=e.book_count?`现存放于 <big>${e.book_keepcity}</big> ，`:""}状态 <big>${e.book_status}</big> 。</p>
            <p><strong>建议分类：</strong><big>${e.book_class}</big></p>
            ${0==e.book_count?'<img src="./mark.svg" style="position:absolute; width:18rem; left:50%; margin-left:-9rem; top:15%; pointer-events:none; opacity:.9" />':""}
          </div>
        `,0==e.book_count&&(o.style="background-color:#eee; filter:grayscale(100%)"),o.addEventListener("click",()=>toggleCardDetails(o)),i.appendChild(o)}),hideSkeleton(),updatePagination()},300)}function updatePagination(){var e=filteredBooks.length,o=Math.max(1,Math.ceil(e/itemsPerPage)),t=filteredBooks.reduce((e,o)=>e+(parseInt(o.book_count,10)||0),0),i=document.getElementById("page-info"),s=document.getElementById("prev-page"),a=document.getElementById("next-page"),n=document.getElementById("book-total"),r=document.getElementById("search-result-total");isSearching?(r.textContent=`找到${e}部 (${t}册) 图书`,n.style.display="none",r.style.display="block"):(n.textContent=`找到${e}部 (${t}册) 图书`,n.style.display="block",r.style.display="none"),i.textContent=currentPage+" / "+o,s.disabled=1===currentPage,a.disabled=currentPage===o||0===e}function changePage(e){currentPage+=e,displayBooks(filteredBooks)}function searchBooks(){document.getElementById("classify").textContent="类别";let o=document.getElementById("search-input").value.toLowerCase();filteredBooks=books.filter(e=>[e.book_name,e.book_press,e.book_author,e.book_class].some(e=>e?.toLowerCase().includes(o))||[e.book_gettime,e.book_getway,e.book_status,e.book_cnClassification,e.book_usClassification].some(e=>e?.toString().includes(o))||e.book_isbn.includes(o)),isSearching=!0,currentPage=1,displayBooks(filteredBooks)}function refreshBooks(e,o=!1){document.getElementById("classify").textContent="类别",filteredBooks=e,isSearching=o,currentPage=1,displayBooks(filteredBooks),document.getElementById("search-input").value=""}function randomSearch(){refreshBooks([...books].sort(()=>Math.random()-.5))}function sortSearch(){refreshBooks([...books].sort((e,o)=>o.id-e.id))}function resetSearch(){refreshBooks([...books].reverse())}displayBooks(filteredBooks);