<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>成语应用（Bootstrap版）</title>

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: 'Microsoft YaHei', '微软雅黑', sans-serif;
    }

    .card {
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
    }

    .option {
      width: 100%;
      margin-bottom: 0.5rem;
    }

    .feedback {
      font-weight: bold;
      margin-top: 1rem;
    }
  </style>
</head>
<body>

  <div class="container py-4">
    <h1 class="text-center mb-4">成语应用</h1>

    <ul class="nav nav-tabs justify-content-center mb-4" id="myTabs">
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#home">首页</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#dictionary">成语词典</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#igcse">IGCSE真题</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#game">成语游戏</a></li>
    </ul>

    <div class="tab-content">

      <!-- 首页 -->
      <div class="tab-pane fade show active" id="home">
        <h2 class="text-center mb-4">每日推荐</h2>
        <div id="random-idioms" class="row g-3"></div>
      </div>

      <!-- 成语词典 -->
      <div class="tab-pane fade" id="dictionary">
        <h2 class="text-center mb-4">成语词典</h2>
        <div class="d-flex justify-content-center mb-3">
          <input type="text" id="search-input" class="form-control w-75" placeholder="输入成语搜索..." />
          <button class="btn btn-primary ms-2" onclick="searchIdiom()">搜索</button>
        </div>
        <div id="search-results"></div>
      </div>

      <!-- IGCSE真题 -->
      <div class="tab-pane fade" id="igcse">
        <h2 class="text-center mb-4">IGCSE真题成语</h2>
        <div id="igcse-idioms"></div>
      </div>

      <!-- 成语游戏 -->
      <div class="tab-pane fade" id="game">
        <h2 class="text-center mb-4">成语游戏</h2>
        <div id="game-container" class="text-center">
          <p id="question" class="lead"></p>
          <div id="options" class="mb-3"></div>
          <div class="feedback text-center" id="feedback"></div>
          <button class="btn btn-outline-primary" onclick="nextQuestion()">下一题</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    let allIdioms = [];
    let igcseData = {
      // 此处省略数据，与原问题一致
    };

    fetch('chengyu.json')
      .then(res => res.json())
      .then(data => {
        allIdioms = data;
        showHome();
        showIgcseIdioms();

        // 监听 tab 切换事件，当切换到 #game 时自动加载第一题
        const tabEl = document.querySelector('#myTabs a[href="#game"]');
        tabEl.addEventListener('shown.bs.tab', () => {
          nextQuestion();
        });
      })
      .catch(err => console.error('数据加载失败:', err));

    function showHome() {
      const randomIds = shuffle(allIdioms).slice(0, 3);
      const container = document.getElementById('random-idioms');
      container.innerHTML = '';
      randomIds.forEach(idiom => {
        const card = document.createElement('div');
        card.className = 'col-md-4';
        card.innerHTML = `
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h5 class="card-title">${idiom.idiom}</h5>
              <p class="card-text">${idiom.definition}</p>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function searchIdiom() {
      const input = document.getElementById('search-input').value.trim();
      const results = allIdioms.filter(i => i.idiom.includes(input) || i.definition.includes(input));
      const container = document.getElementById('search-results');
      container.innerHTML = '';
      if (results.length === 0) {
        container.innerHTML = '<p class="text-muted">未找到相关成语。</p>';
      } else {
        results.forEach(i => {
          const card = document.createElement('div');
          card.className = 'card mb-2 shadow-sm';
          card.innerHTML = `
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">${i.idiom}</h6>
              <p class="card-text">${i.definition}</p>
            </div>
          `;
          container.appendChild(card);
        });
      }
    }

    function showIgcseIdioms() {
      const container = document.getElementById('igcse-idioms');
      container.innerHTML = '';
      Object.entries(igcseData).forEach(([exam, idioms]) => {
        const section = document.createElement('div');
        section.className = 'mb-4';
        section.innerHTML = `<h4 class="text-info">${exam}</h4>`;
        const list = document.createElement('div');
        idioms.forEach(idiom => {
          const item = allIdioms.find(i => i.idiom === idiom);
          if (item) {
            const card = document.createElement('div');
            card.className = 'card mb-2 shadow-sm';
            card.innerHTML = `
              <div class="card-body">
                <h6 class="card-title">${item.idiom}</h6>
                <p class="card-text">释义：${item.definition}</p>
                <p class="card-text">出处：${exam}</p>
              </div>
            `;
            list.appendChild(card);
          }
        });
        section.appendChild(list);
        container.appendChild(section);
      });
    }

    let currentQuestion = null;

    function nextQuestion() {
      const randomIdiom = allIdioms[Math.floor(Math.random() * allIdioms.length)];
      const options = [randomIdiom.definition];
      while (options.length < 4) {
        const def = allIdioms[Math.floor(Math.random() * allIdioms.length)].definition;
        if (!options.includes(def)) options.push(def);
      }
      shuffle(options);

      currentQuestion = {
        idiom: randomIdiom.idiom,
        correctIndex: options.indexOf(randomIdiom.definition)
      };

      document.getElementById('question').textContent = `请选择“${randomIdiom.idiom}”的正确释义：`;
      document.getElementById('options').innerHTML = options.map((def, index) => `
        <button class="btn btn-outline-secondary option" onclick="checkAnswer(${index})">${def}</button>
      `).join('');
      document.getElementById('feedback').textContent = '';
    }

    function checkAnswer(index) {
      const feedback = document.getElementById('feedback');
      if (index === currentQuestion.correctIndex) {
        feedback.textContent = '正确！🎉';
        feedback.className = 'feedback text-success';
      } else {
        const correctDef = allIdioms.find(i => i.idiom === currentQuestion.idiom).definition;
        feedback.textContent = `错误。正确答案是：${correctDef}`;
        feedback.className = 'feedback text-danger';
      }
    }

    function shuffle(arr) {
      return [...arr].sort(() => Math.random() - 0.5);
    }
  </script>
</body>
</html>