<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆè¯­åº”ç”¨ï¼ˆä¼˜åŒ–ç‰ˆï¼‰</title>

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* è‡ªå®šä¹‰æ ·å¼ï¼šè“è‰²ä¸»è‰²è°ƒ */
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      background-color: #f9f9f9;
    }

    h1, h2, h3, h4, h5, h6 {
      color: #0d6efd; /* Bootstrap Primary è“è‰² */
    }

    .nav-tabs .nav-link.active {
      background-color: #0d6efd;
      color: white !important;
    }

    .nav-tabs .nav-link {
      color: #0d6efd;
    }

    .card {
      border-color: #0d6efd;
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      border-color: #007bff;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: bold;
    }

    .btn-primary {
      background-color: #0d6efd;
      border-color: #0d6efd;
    }

    .btn-primary:hover {
      background-color: #0056b3;
      border-color: #0056b3;
    }

    .card-text strong {
      color: #007bff;
    }

    mark {
      background-color: #ffc107;
      padding: 0 2px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div class="container py-4">
    <h1 class="text-center mb-4">æˆè¯­åº”ç”¨</h1>

    <ul class="nav nav-tabs justify-content-center mb-4" id="myTabs">
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#home">é¦–é¡µ</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#dictionary">æˆè¯­è¯å…¸</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#igcse">IGCSEçœŸé¢˜</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#game">æˆè¯­æ¸¸æˆ</a></li>
    </ul>

    <div class="tab-content">

      <!-- é¦–é¡µ -->
      <div class="tab-pane fade show active" id="home">
        <h2 class="text-center mb-4">æ¯æ—¥æ¨è</h2>
        <div id="random-idioms" class="row g-3"></div>
      </div>

      <!-- æˆè¯­è¯å…¸ -->
      <div class="tab-pane fade" id="dictionary">
        <h2 class="text-center mb-4">æˆè¯­è¯å…¸</h2>
        <div class="d-flex justify-content-center mb-3">
          <input type="text" id="search-input" class="form-control w-75" placeholder="è¾“å…¥æˆè¯­æœç´¢..." />
          <button class="btn btn-primary ms-2" onclick="searchIdiom()">æœç´¢</button>
        </div>
        <div id="search-results"></div>
      </div>

      <!-- IGCSEçœŸé¢˜ -->
      <div class="tab-pane fade" id="igcse">
        <h2 class="text-center mb-4">IGCSEçœŸé¢˜æˆè¯­</h2>
        <div id="igcse-idioms"></div>
      </div>

      <!-- æˆè¯­æ¸¸æˆ -->
      <div class="tab-pane fade" id="game">
        <h2 class="text-center mb-4">æˆè¯­æ¸¸æˆ</h2>
        <div id="game-container" class="text-center">
          <p id="question" class="lead"></p>
          <div id="options" class="mb-3"></div>
          <div class="feedback text-center" id="feedback"></div>
          <button class="btn btn-outline-primary" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    let allIdioms = [];
    let igcseData = {
      "0509_s16_in_11": [
        "ä¸€æˆä¸å˜",
        "ä¸€ç›®äº†ç„¶",
        "æ¯æ¯ç›¸å…³",
        "æ—¥æ–°æœˆå¼‚",
        "ç™¾æ€ä¸è§£"
      ],
      "0509_s16_in_13": ["å¹³å¿ƒé™æ°”", "æ½œç§»é»˜åŒ–"],
      "0509_s17_in_11": [
        "å¤©æ˜åœ°æš—",
        "å±±ç©·æ°´å°½",
        "å¿µå¿µä¸å¿˜",
        "æ¯æ¯ç›¸å…³",
        "æ— ç©·æ— å°½",
        "æŸ³æš—èŠ±æ˜",
        "éšé‡è€Œå®‰",
        "é’å±±ç»¿æ°´"
      ],
      "0509_s17_in_13": [
        "ä¸åŒå…¶çƒ¦",
        "äº‘æ³¥ä¹‹åˆ«",
        "å¹³æ·¡æ— å¥‡",
        "æˆªç„¶ä¸åŒ",
        "é€šå®µè¾¾æ—¦"
      ],
      "0509_s18_in_11": [
        "å¤å¾€ä»Šæ¥",
        "æƒ¶æƒ¶ä¸å®‰",
        "æ¸¸å±±ç©æ°´",
        "ç‰¹ç«‹ç‹¬è¡Œ",
        "ç¦»ç»å›é“"
      ],
      "0509_s18_in_13": [
        "ä¸çŸ¥ä¸è§‰",
        "ä»¥å·±åº¦äºº",
        "å¤šæ­¤ä¸€ä¸¾",
        "é•¿æ­¤ä»¥å¾€"
      ],
      "0509_s19_in_11": [
        "ä¸åˆæ—¶å®œ",
        "äººæ»¡ä¸ºæ‚£",
        "åˆ€è€•ç«ç§",
        "å´‡å±±å³»å²­",
        "æˆç¾¤ç»“é˜Ÿ",
        "æ”¿å‡ºå¤šé—¨",
        "æµ©æµ©è¡è¡",
        "é£åœŸäººæƒ…"
      ],
      "0509_s19_in_12": [
        "ä¸€æ‰«è€Œç©º",
        "åŠé€”è€ŒåºŸ",
        "å¿ƒè¡€æ¥æ½®",
        "æ— è®ºå¦‚ä½•",
        "æ¬²é€Ÿåˆ™ä¸è¾¾",
        "é©¬ä¸åœè¹„"
      ],
      "0509_s19_in_13": [
        "ä¸€ä¸¾ä¸€åŠ¨",
        "åƒåƒä¸‡ä¸‡",
        "åƒå˜ä¸‡åŒ–",
        "å¿ƒæœ‰çµçŠ€ä¸€ç‚¹é€š",
        "æ€¡ç„¶è‡ªå¾—",
        "æ‚£å¾—æ‚£å¤±",
        "æ— è®ºå¦‚ä½•",
        "æ²¹ç›é…±é†‹",
        "æ´¥æ´¥æœ‰å‘³",
        "æµ·é˜”å¤©ç©º",
        "ç”œè¨€èœœè¯­",
        "éƒéƒè‘±è‘±"
      ],
      "0509_s20_in_11": [
        "å‹¤èƒ½è¡¥æ‹™",
        "åæœ‰å…«ä¹",
        "å¾®ä¸è¶³é“",
        "æ— èƒ½ä¸ºåŠ›",
        "æœªé›¨ç»¸ç¼ª",
        "æŸæ‰‹æ— ç­–",
        "ç‹¬æ¥ç‹¬å¾€"
      ],
      "0509_s20_in_13": ["ä¸€å›¢å’Œæ°”", "ä¸€æ¨¡ä¸€æ ·", "å…”èµ·é¹˜è½"],
      "0509_s21_in_12": [
        "åšå°ä¼ä½",
        "å¤©å—åœ°åŒ—",
        "å½’æ ¹ç»“åº•",
        "å¾—æ„æ´‹æ´‹",
        "å¿¿å¿¿ä¸å¹³",
        "é•¿åçŸ­å¹"
      ],
      "0509_s21_in_13": [
        "ä¸€è§†åŒä»",
        "å‡ºäººå¤´åœ°",
        "å°é¢˜å¤§åš",
        "æ— å¯åšé",
        "æ—¥ä¸Šä¸‰ç«¿",
        "è½»æ‰‹è½»è„š"
      ],
      "0509_s22_in_11": [
        "å¦™æ‰‹å›æ˜¥",
        "å¾·è‰ºåŒé¦¨",
        "æ˜‚é¦–æŒºèƒ¸",
        "è¨€è¿‡å…¶å®"
      ],
      "0509_s22_in_13": ["å‰è½¦ä¹‹é‰´", "éšå¿ƒæ‰€æ¬²"],
      "0509_s23_in_12": [
        "ä¸çŸ¥ä¸è§‰",
        "ä¸ç½®å¯å¦",
        "ä¸¾ä¸–æ— åŒ",
        "ä»¥å‡ä¹±çœŸ",
        "ä¼—æ‰€å‘¨çŸ¥",
        "å‡¡å¤«ä¿—å­",
        "å‘±å‘±å åœ°",
        "å·®ä¹‹æ¯«é‡ï¼Œå¤±ä¹‹åƒé‡Œ",
        "æŒä¹‹ä»¥æ†",
        "æœªé›¨ç»¸ç¼ª",
        "æ°´æ³„ä¸é€š",
        "æ¼«å±±éé‡",
        "ç‹¬å…·åŒ å¿ƒ",
        "è§é£è½¬èˆµ",
        "è¿‡ç›®ä¸å¿˜"
      ],
      "0509_s23_in_13": [
        "æœ‰é’±æœ‰åŠ¿",
        "ç å…‰å®æ°”",
        "é’¢ç­‹é“éª¨"
      ],
      "0509_s24_in_12": [
        "äº‹åŠåŠŸå€",
        "å–œæ€’æ— å¸¸",
        "å¿½å†·å¿½çƒ­"
      ],
      "0509_s24_in_13": [
        "å›«å›µåæ£",
        "æ…¢æ¡æ–¯ç†",
        "æ±—æµæµƒèƒŒ",
        "è¨€ä¼ èº«æ•™",
        "é‡åŠ›è€Œè¡Œ"
      ],
      "0509_s25_in_13": [
        "å‡ºå…¶ä¸æ„",
        "åƒç¯‡ä¸€å¾‹",
        "å“‘å£æ— è¨€",
        "å“­ç¬‘ä¸å¾—",
        "å¦‚é‡Šé‡è´Ÿ",
        "å­¤æ³¨ä¸€æ·",
        "å¿«äººå¿«è¯­",
        "æ ‡æ–°ç«‹å¼‚",
        "æ­£è¥Ÿå±å",
        "æ­£é¢œå‰è‰²",
        "ç†ç›´æ°”å£®",
        "ç³ç…æ»¡ç›®",
        "èƒ¸æœ‰æˆç«¹",
        "è¯­é‡å¿ƒé•¿",
        "è¹‘æ‰‹è¹‘è„š",
        "è¿…é›·ä¸åŠæ©è€³",
        "è¿›å¾·ä¿®ä¸š"
      ]
    };

    // åŠ è½½ JSON æ•°æ®
    fetch('chengyu.json')
      .then(res => res.json())
      .then(data => {
        allIdioms = data;
        showHome();
        showIgcseIdioms();

        // ç›‘å¬ tab åˆ‡æ¢äº‹ä»¶ï¼Œè‡ªåŠ¨åŠ è½½æ¸¸æˆç¬¬ä¸€é¢˜
        const tabEl = document.querySelector('#myTabs a[href="#game"]');
        tabEl.addEventListener('shown.bs.tab', () => {
          nextQuestion();
        });
      })
      .catch(err => console.error('æ•°æ®åŠ è½½å¤±è´¥:', err));

    // æ˜¾ç¤ºé¦–é¡µéšæœºæˆè¯­
    function showHome() {
      const randomIds = shuffle(allIdioms).slice(0, 3);
      const container = document.getElementById('random-idioms');
      container.innerHTML = '';
      randomIds.forEach(idiom => {
        const card = document.createElement('div');
        card.className = 'col-md-4';
        card.innerHTML = `
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h5 class="card-title">${idiom.idiom}</h5>
              <p class="card-text">${idiom.definition}</p>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    // é«˜äº®å…³é”®è¯å‡½æ•°
    function highlightText(text, keyword) {
      if (!keyword || !text) return text;

      const escapeRegExp = (s) => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const pattern = new RegExp(`(${escapeRegExp(keyword)})`, 'gi');
      return text.replace(pattern, '<mark>$1</mark>');
    }

    // æœç´¢æˆè¯­
    function searchIdiom() {
      const input = document.getElementById('search-input').value.trim();
      const results = allIdioms.filter(idiom =>
        idiom.idiom.toLowerCase().includes(input.toLowerCase()) ||
        idiom.definition.toLowerCase().includes(input.toLowerCase())
      );
      const container = document.getElementById('search-results');
      container.innerHTML = '';

      if (results.length === 0) {
        container.innerHTML = '<p class="text-muted">æœªæ‰¾åˆ°ç›¸å…³æˆè¯­ã€‚</p>';
      } else {
        results.forEach(idiom => {
          const highlightedIdiom = highlightText(idiom.idiom, input);
          const highlightedDef = highlightText(idiom.definition, input);

          const card = document.createElement('div');
          card.className = 'card mb-2 shadow-sm';
          card.innerHTML = `
            <div class="card-body">
              <h6 class="card-title">${highlightedIdiom}</h6>
              <p class="card-text">${highlightedDef}</p>
            </div>
          `;
          container.appendChild(card);
        });
      }
    }

    // æ˜¾ç¤º IGCSE æˆè¯­
    function showIgcseIdioms() {
      const container = document.getElementById('igcse-idioms');
      container.innerHTML = '';
      Object.entries(igcseData).forEach(([exam, idioms]) => {
        const section = document.createElement('div');
        section.className = 'mb-4';
        section.innerHTML = `<h4 class="text-info">${exam}</h4>`;
        const list = document.createElement('div');

        idioms.forEach(idiomName => {
          const item = allIdioms.find(i => i.idiom === idiomName);
          if (item) {
            const card = document.createElement('div');
            card.className = 'card mb-2 shadow-sm';
            card.innerHTML = `
              <div class="card-body">
                <h6 class="card-title">${item.idiom}</h6>
                <p class="card-text"><strong>é‡Šä¹‰ï¼š</strong>${item.definition}</p>
                <p class="card-text"><strong>å‡ºå¤„ï¼š</strong>${exam}</p>
              </div>
            `;
            list.appendChild(card);
          } else {
            console.warn(`IGCSE ä¸­çš„æˆè¯­ "${idiomName}" æœªåœ¨ chengyu.json ä¸­æ‰¾åˆ°`);
          }
        });

        if (list.children.length > 0) {
          section.appendChild(list);
        } else {
          section.innerHTML += `<p class="text-muted">æœªæ‰¾åˆ°å¯¹åº”æˆè¯­ã€‚</p>`;
        }

        container.appendChild(section);
      });
    }

    // åˆå§‹åŒ–æ¸¸æˆ
    let currentQuestion = null;

    function nextQuestion() {
      const randomIdiom = allIdioms[Math.floor(Math.random() * allIdioms.length)];
      const options = [randomIdiom.definition];

      while (options.length < 4) {
        const def = allIdioms[Math.floor(Math.random() * allIdioms.length)].definition;
        if (!options.includes(def)) options.push(def);
      }
      shuffle(options);

      currentQuestion = {
        idiom: randomIdiom.idiom,
        correctIndex: options.indexOf(randomIdiom.definition)
      };

      document.getElementById('question').textContent = `è¯·é€‰æ‹©â€œ${randomIdiom.idiom}â€çš„æ­£ç¡®é‡Šä¹‰ï¼š`;
      document.getElementById('options').innerHTML = options.map((def, index) => `
        <button class="btn btn-outline-secondary option" onclick="checkAnswer(${index})">${def}</button>
      `).join('');
      document.getElementById('feedback').textContent = '';
    }

    function checkAnswer(index) {
      const feedback = document.getElementById('feedback');
      if (index === currentQuestion.correctIndex) {
        feedback.textContent = 'æ­£ç¡®ï¼ğŸ‰';
        feedback.className = 'feedback text-success';
      } else {
        const correctDef = allIdioms.find(i => i.idiom === currentQuestion.idiom).definition;
        feedback.textContent = `é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${correctDef}`;
        feedback.className = 'feedback text-danger';
      }
    }

    // è¾…åŠ©å‡½æ•°ï¼šæ´—ç‰Œ
    function shuffle(array) {
      return [...array].sort(() => Math.random() - 0.5);
    }
  </script>
</body>
</html>